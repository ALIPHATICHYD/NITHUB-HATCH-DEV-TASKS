{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["nonNullable","getTracer","AppRenderSpan","decodeText","encodeText","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","streamToBufferedResult","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","end","destroy","pipe","join","readableStreamTee","readable","transformStream","TransformStream","transformStream2","writer","getWriter","writer2","reader","getReader","read","then","done","value","close","chainStreams","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","streamFromArray","strings","forEach","str","streamToString","stream","bufferedString","createBufferedTransformStream","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","flush","createInsertedHTMLStream","getServerInsertedHTML","insertedHTMLChunk","renderToInitialStream","ReactDOMServer","element","streamOptions","trace","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","createInlineDataStream","dataStream","dataStreamFinished","dataStreamReader","err","error","createSuffixStream","foundSuffix","endsWith","contentWithoutSuffix","createRootLayoutValidatorStream","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","JSON","stringify","tree","continueFromInitialStream","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}