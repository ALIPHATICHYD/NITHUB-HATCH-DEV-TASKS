{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["createHash","promises","mediaType","chalk","contentDisposition","getOrientation","Orientation","imageSizeOf","isAnimated","join","nodeUrl","getImageBlurSvg","hasMatch","createRequestResponseMocks","sendEtagResponse","getContentType","getExtension","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","e","showSharpMissingWarning","NODE_ENV","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","force","recursive","catch","rmdir","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","Math","max","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","optimizeImage","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","method","socket","res","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","finished","contentDispositionType","contentSecurityPolicy","sendResponse","result","byteLength","end","getImageSize","metadata","decodeBuffer","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}