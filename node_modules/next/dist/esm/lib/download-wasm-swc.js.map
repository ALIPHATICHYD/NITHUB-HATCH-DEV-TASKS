{"version":3,"sources":["../../src/lib/download-wasm-swc.ts"],"names":["os","fs","path","Log","tar","fetch","require","WritableStream","fileExists","getRegistry","MAX_VERSIONS_TO_CACHE","downloadWasmSwc","version","wasmDirectory","variant","pkgName","tarFileName","substring","outputDirectory","join","cacheDirectory","result","envDefined","process","env","systemCacheDirectory","platform","XDG_CACHE_HOME","homedir","LOCALAPPDATA","dir","tmpdir","console","error","Error","exit","isAbsolute","resolve","cwd","promises","mkdir","recursive","extractFromTar","x","file","strip","info","tempFile","Date","now","registry","then","res","ok","body","status","cacheWriteStream","createWriteStream","pipeTo","write","chunk","close","rename","cacheFiles","readdir","length","sort","a","b","localeCompare","i","unlink","catch"],"mappings":"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"}