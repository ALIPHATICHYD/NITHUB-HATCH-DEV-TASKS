{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["getHash","detectContentType","ImageOptimizerCache","ImageError","getMaxAge","optimizeImage","imageOptimizer","sendResponse","getImageSize","Deferred","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","e","showSharpMissingWarning","NODE_ENV","getSupportedMimeType","options","accept","mimeType","mediaType","includes","items","hash","createHash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","join","promises","rm","force","recursive","catch","rmdir","mkdir","writeFile","every","b","i","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","hasMatch","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","Math","max","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","age","endsWith","slice","n","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","chalk","yellow","bold","webp","png","jpeg","toBuffer","orientation","getOrientation","operations","Orientation","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","createRequestResponseMocks","method","socket","res","nodeUrl","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","isAnimated","getExtension","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getImageBlurSvg","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","sendEtagResponse","finished","contentDisposition","contentDispositionType","contentSecurityPolicy","getContentType","result","byteLength","end","metadata","decodeBuffer","imageSizeOf","promise","Promise","resolve","reject"],"mappings":"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"}