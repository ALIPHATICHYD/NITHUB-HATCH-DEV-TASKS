{"version":3,"sources":["../../../src/server/lib/start-server.ts"],"names":["startServer","dir","prevDir","port","isDev","hostname","useWorkers","allowRetry","keepAliveTimeout","onStdout","onStderr","process","sockets","Set","worker","handlersReady","handlersError","isNodeDebugging","execArgv","some","localArg","startsWith","env","NODE_OPTIONS","match","handlersPromise","Promise","resolve","reject","requestHandler","_req","_res","Error","upgradeHandler","_socket","_head","server","http","createServer","req","res","undefined","add","on","delete","err","statusCode","end","Log","error","url","console","socket","head","destroy","portRetryCount","code","warn","listen","exit","targetHost","addr","address","host","normalizedHostname","isIPv6","appUrl","debugPort","getDebugPort","info","ready","httpProxy","require","renderServerPath","jestWorkerPath","replace","Worker","routerWorker","numWorkers","maxRetries","forkOptions","genRouterWorkerExecArgv","FORCE_COLOR","initialEnv","PORT","getNodeOptionsWithoutInspect","NEXT_CPU_PROF","__NEXT_PRIVATE_CPU_PROFILE","WATCHPACK_WATCHER_LIMIT","exposedMethods","didInitialize","_worker","_workerPool","_workers","_child","signal","workerStdout","getStdout","workerStderr","getStderr","data","stdout","write","stderr","routerPort","initialize","dev","workerType","getProxyServer","pathname","targetUrl","proxyServer","createProxy","target","changeOrigin","ignorePath","xfwd","ws","followRedirects","_err","urlParts","split","urlNoQuery","cleanUrl","normalizeRepeatedSlashes","setHeader","proxyReq","proxyRes","web","next","app","httpServer","customServer","getRequestHandler","getUpgradeHandler","prepare","teardown","close","forEach"],"mappings":"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"}